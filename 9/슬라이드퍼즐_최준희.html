<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìŠ¬ë¼ì´ë“œ í¼ì¦</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&display=swap");

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background-color: lightgray;
      }
      #title {
        position: absolute;
        font-size: 50px;
        top: 100px;
        font-family: cinzel;
        text-shadow: 0 0 10px blue;
      }
      #puzzleContainer {
        width: 400px;
        height: 400px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 2px;
        border: 2px solid black;
        margin-top: 20px;
        object-fit: contain;
      }
      .tile {
        background-size: 300%; /* 3x3 ê¸°ì¤€ , ì¤‘ìš” !! ì´ë¯¸ì§€ë¥¼ 3ë°°ë¡œ í‚¤ìš´ë‹¤ìŒ ì˜ì—­ ì„¤ì •í›„ ë³´ì—¬ì¤Œ*/
        cursor: pointer;
      }
      #controls {
        display: flex;
        gap: 10px;
      }
      .buttonDiv {
        padding: 10px 20px;
        border: 1px solid #333;
        cursor: pointer;
        text-align: center;
        user-select: none;
      }
      #selectImage {
        background-color: white;
        color: blue;
        border: none;
      }
      #shuffle {
        background-color: red;
        color: white;
        border: none;
      }
      #selectImage:hover {
        cursor: pointer;
        box-shadow: 0 0 8px gray;
      }
      #shuffle:hover {
        cursor: pointer;
        box-shadow: 0 0 8px red;
      }
      #originalPicture {
        position: absolute; /* í™”ë©´ íŠ¹ì • ìœ„ì¹˜ì— ê³ ì • */
        top: 480px; /* ìœ„ì—ì„œ 50px */
        left: 450px; /* í¼ì¦ ì˜¤ë¥¸ìª½ì— ìœ„ì¹˜ (í¼ì¦ ê°€ë¡œ 400px + ê°„ê²© 20px) */
        width: 200px; /* ì˜ì—­ ê°€ë¡œ í¬ê¸° */
        height: 200px; /* ì„ì‹œ ë†’ì´ ì§€ì • */
        border: 2px dashed black; /* ì ì„  í…Œë‘ë¦¬ë¡œ ì˜ì—­ í™•ì¸ */
        display: flex; /* ì´ë¯¸ì§€ ë“¤ì–´ê°€ë„ ì¤‘ì•™ ì •ë ¬ ê°€ëŠ¥ */
        background-color: lightgray;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        z-index: 10; /* ë‹¤ë¥¸ ìš”ì†Œë³´ë‹¤ ìœ„ë¡œ í‘œì‹œ */
        object-fit: contain;
      }
    </style>
  </head>
  <body>
    <div id="title">slide puzzle</div>
    <div id="controls">
      <div id="selectImage" class="buttonDiv">Image</div>
      <div id="shuffle" class="buttonDiv">Shuffle!</div>
    </div>

    <input type="file" id="imageInput" accept="image/*" style="display: none" />

    <div id="puzzleContainer"></div>
    <div id="originalPicture"></div>

    <script>
      const puzzleContainer = document.getElementById("puzzleContainer"); //í¼ì¦ ì‚¬ì§„ì´ ë“¤ì–´ê°ˆ ì˜ì—­
      const imageInput = document.getElementById("imageInput"); // ì´ë¯¸ì§€ ì‚½ì… input
      const selectImageBtn = document.getElementById("selectImage"); //ì´ë¯¸ì§€ ì„ íƒ ë²„íŠ¼
      const shuffleBtn = document.getElementById("shuffle"); //ì…”í”Œ ë²„íŠ¼

      const size = 3; // 3x3 í¼ì¦
      let tiles = []; //ê° íƒ€ì¼ì„ ë‹´ëŠ” ë°°ì—´
      let emptyIndex = size * size - 1; // ë§ˆì§€ë§‰ íƒ€ì¼
      let imgSrc = ""; //ì„ íƒí•œ ì´ë¯¸ì§€

      // ë²„íŠ¼ í´ë¦­ -> íŒŒì¼ ì„ íƒ
      selectImageBtn.onclick = () => imageInput.click(); //ì´ë¯¸ì§€ë²„íŠ¼ ëˆ„ë¥´ë©´ input ì‹¤í–‰

      imageInput.onchange = (e) => {
        const file = e.target.files[0]; //ì‚¬ìš©ìê°€ ê³ ë¥¸ ì²«ë²ˆì§¸ íŒŒì¼
        if (!file) return; //ì·¨ì†Œ ë° íŒŒì¼ ì—†ì„ì‹œ ì•„ë¬´ í–‰ë™ x
        imgSrc = URL.createObjectURL(file); //íŒŒì¼ì˜ ì„ì‹œ URL
        originalPicture = document.getElementById("originalPicture"); //ë¯¸ë¦¬ë³´ê¸° í™”ë©´
        originalPicture.style.backgroundImage = `url(${imgSrc})`; //ë¯¸ë¦¬ë³´ê¸°ì— ì‚¬ì§„ ë„£ê¸°
        originalPicture.style.backgroundSize = "cover";
        originalPicture.style.backgroundPosition = "center";
        originalPicture.style.backgroundRepeat = "no-repeat";
        createPuzzle(); //ìƒˆ í¼ì¦ ìƒì„± í•¨ìˆ˜ ì‹¤í–‰
      };

      function createPuzzle() {
        let emptyIndex = size * size - 1; // ë§ˆì§€ë§‰ íƒ€ì¼

        puzzleContainer.innerHTML = ""; //í¼ì¦ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
        tiles = []; //íƒ€ì¼ ì •ë³´ë¥¼ ì €ì¥í•  ë°°ì—´, ê¸°ì¡´ íƒ€ì¼ ë°°ì—´ ì´ˆê¸°í™”

        for (let i = 0; i < size * size; i++) {
          //3X3 ì¦‰ 0~8 ì„ ë°˜ë³µë¬¸
          const tile = document.createElement("div"); // 8ê°œì˜ íƒ€ì¼ div ìƒì„±
          tile.classList.add("tile"); //íƒ€ì¼ì— tile - classë¥¼ ì¶”ê°€
          tile.dataset.index = i; //ê° íƒ€ì¼ì— index ì •ë³´ ì¶”ê°€

          if (i !== emptyIndex) {
            //3x3ì—ì„œëŠ” emptyIndexê°€ 8
            tile.style.backgroundImage = `url(${imgSrc})`;
            const row = Math.floor(i / size); // í–‰ : 0,0,0,1,1,1,2,2,2
            const col = i % size; //             ì—´ : 0,1,2,0,1,2,0,1,2
            tile.style.backgroundPosition = `${(col / (size - 1)) * 100}% ${
              (row / (size - 1)) * 100 // í•´ë‹¹ tileì—ì„œ ë³´ì—¬ì¤„ ì˜ì—­ ì„¤ì •, ì¶”í›„ ì •ë‹µ ìœ„ì¹˜
            }%`;
          }
          tile.onclick = () => moveTile(i); //ëˆ„ë¥¸ íƒ€ì¼ì˜ indexê°’ì„ ë°›ì•„ moveTile í•¨ìˆ˜ë¡œ ì´ë™
          puzzleContainer.appendChild(tile); //ë¶€ëª¨ìš”ì†Œ.appendchild(ìì‹ìš”ì†Œ) -DOMì— ì¶”ê°€
          tiles.push(tile); // ëª¨ë“  íƒ€ì¼ì„ ë°°ì—´ë¡œ ê´€ë¦¬
        }
      }

      function getMovableIndexes() {
        const indexes = []; //ì´ë™ ê°€ëŠ¥í•œ íƒ€ì¼ë“¤ì˜ ë°°ì—´
        const emptyRow = Math.floor(emptyIndex / size); // 8ë‚˜ëˆ„ê¸°3 ëª«ì˜ ë‚´ë¦¼ : 2
        const emptyCol = emptyIndex % size; // 8ë‚˜ëˆ„ê¸°3ì˜ ë‚˜ë¨¸ì§€ 2
        if (emptyRow > 0) indexes.push(emptyIndex - size); //index : 5
        if (emptyRow < size - 1) indexes.push(emptyIndex + size);
        if (emptyCol > 0) indexes.push(emptyIndex - 1); // index : 7
        if (emptyCol < size - 1) indexes.push(emptyIndex + 1);
        return indexes;
      }

      let isShuffling = false;

      shuffleBtn.onclick = () => shufflePuzzle(); //ì…”í”Œ ë²„íŠ¼ í´ë¦­ì‹œ shuffle í•¨ìˆ˜ ì‹¤í–‰

      function shufflePuzzle() {
        isShuffling = true;
        for (let i = 0; i < 100; i++) {
          const movable = getMovableIndexes();
          const rand = movable[Math.floor(Math.random() * movable.length)]; //movable[0~1]
          moveTile(rand);
        }
        isShuffling = false;
      }

      function moveTile(i) {
        const targetRow = Math.floor(i / size); // 7/3ì˜ ë‚´ë¦¼ : 2
        const targetCol = i % size; // 7/3ì˜ ë‚˜ë¨¸ì§€ : 1
        const emptyRow = Math.floor(emptyIndex / size); // 8/3ì˜ ë‚´ë¦¼ : 2
        const emptyCol = emptyIndex % size; // 8/3ì˜ ë‚˜ë¨¸ì§€ : 2
        if (
          (targetRow === emptyRow && Math.abs(targetCol - emptyCol) === 1) ||
          (targetCol === emptyCol && Math.abs(targetRow - emptyRow) === 1)
        ) {
          [
            tiles[i].style.backgroundImage,
            tiles[emptyIndex].style.backgroundImage,
          ] = [
            tiles[emptyIndex].style.backgroundImage,
            tiles[i].style.backgroundImage,
          ];
          [
            tiles[i].style.backgroundPosition,
            tiles[emptyIndex].style.backgroundPosition,
          ] = [
            tiles[emptyIndex].style.backgroundPosition,
            tiles[i].style.backgroundPosition,
          ];
          emptyIndex = i; //
          if (!isShuffling && checkSolved()) {
            setTimeout(() => alert("í¼ì¦ ì™„ì„±! ğŸ‰"), 100);
          }
        }

        function checkSolved() {
          for (let i = 0; i < tiles.length - 1; i++) {
            // i < 7 => ì²« emptyindex(8ë²ˆ) ì œì™¸í•˜ê³ 
            const row = Math.floor(i / size); // í–‰ : 0,0,0,1,1,1,2,2
            const col = i % size; // ì—´ : 0,1,2,0,1,2,0,1
            const correctPos = `${(col / (size - 1)) * 100}% ${
              (row / (size - 1)) * 100
            }%`;
            if (tiles[i].style.backgroundPosition !== correctPos) return false;
          }
          return true;
        }
      }
    </script>
  </body>
</html>
